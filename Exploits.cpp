#include "Exploits.h"
#include "Util.h"
#include "include.h"

namespace Hooks {

	PVOID LocalPlayerPawn = nullptr;
	PVOID LocalPlayerController = nullptr;
	PVOID TargetPawn = nullptr;
	auto OriginalAitstuck = 0;

	PVOID calculateSpreadCaller = nullptr;
	float originalReloadTime = 0.0f;

	BOOLEAN GetTarget(FVector& out) {
		if (!Hooks::TargetPawn) {
			return FALSE;
		}

		auto mesh = ReadPointer(Hooks::TargetPawn, 0x280);
		if (!mesh) {
			return FALSE;
		}

		auto bones = ReadPointer(mesh, 0x478);
		if (!bones) bones = ReadPointer(mesh, 0x478 + 0x10);
		if (!bones) {
			return FALSE;
		}

		float compMatrix[4][4] = { 0 };
		Util::ToMatrixWithScale(reinterpret_cast<float*>(reinterpret_cast<PBYTE>(mesh) + 0x1C0), compMatrix);

		return TRUE;
	}
}